library(lubridate)
library(ggplot2)
library(stringr)
bnb.raw <- read.csv("airbnb_data.csv") %>%
mutate(price = exp(log_price))
bnb.data <- bnb.raw %>%
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(amenities = as.character(amenities)) %>%
mutate(am_Internet = (str_detect(amenities, "Internet") |
str_detect(amenities, "Wireless Internet")),
am_TV = (str_detect(amenities, "TV") | str_detect(amenities, "Cable TV")),
am_AC = str_detect(amenities, "Air conditioning"),
am_Kitchen = str_detect(amenities, "Kitchen"),
am_Heating = str_detect(amenities, "Heating"),
am_Washer = str_detect(amenities, "Washer"),
am_Dryer = str_detect(amenities, "Dryer"),
am_Parking = str_detect(amenities, "Free parking on premises"),
am_Shampoo = str_detect(amenities, "Shampoo"),
am_Essentials = str_detect(amenities, "Essentials"))
summary(bnb.data)
source('G:/Box Sync/MyFiles/722/homework/FP/DataCleaning.R')
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(zoo)
library(lubridate)
library(ggplot2)
library(stringr)
bnb.raw <- read.csv("airbnb_data.csv") %>%
mutate(price = exp(log_price))
bnb.data <- bnb.raw %>%
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(amenities = as.character(amenities)) %>%
mutate(am_Internet = (str_detect(amenities, "Internet") |
str_detect(amenities, "Wireless Internet")),
am_TV = (str_detect(amenities, "TV") | str_detect(amenities, "Cable TV")),
am_AC = str_detect(amenities, "Air conditioning"),
am_Kitchen = str_detect(amenities, "Kitchen"),
am_Heating = str_detect(amenities, "Heating"),
am_Washer = str_detect(amenities, "Washer"),
am_Dryer = str_detect(amenities, "Dryer"),
am_Parking = str_detect(amenities, "Free parking on premises"),
am_Shampoo = str_detect(amenities, "Shampoo"),
am_Essentials = str_detect(amenities, "Essentials"))
summary(bnb.data)
test.data <- bnb.data %>%
filter(post_wait < 0) #22 obs has host_since > first_review...
attach(bnb.data)
ggplot(bnb.data,aes(x=post_wait))+geom_density()
hist(post_wait)
hist(price)
hist(accommodates)
hist(beds)
hist(bedrooms)
save(bnb.data, file = "bnb_data.Rdata")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(maps)
states_map <- map_data("state")
head(states_map)
con=dbConnect(MySQL(),user='root',password='123',dbname='cmcc',host='localhost')
library(ggmap)
library(mapproj)
library(DBI)
library(RMySQL)
install.packages("mapproj")
install.packages("RMySQL")
con=dbConnect(MySQL(),user='root',password='123',dbname='cmcc',host='localhost')
library(ggmap)
library(mapproj)
library(DBI)
library(RMySQL)
con=dbConnect(MySQL(),user='root',password='123',dbname='cmcc',host='localhost')
load("bnb_data.Rdata")
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(maps)
states_map <- map_data("state")
head(states_map)
load("bnb_data.Rdata")
View(bnb.data)
bnb_map <- load("bnb_data.Rdata") %>%
select(longitude, latitude, X)
bnb_map <- load("bnb_data.Rdata") %>%
select(longitude & latitude & X)
library(dplyr)
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
bnb_map <- load("bnb_data.Rdata") %>%
select(longitude & latitude & X)
bnb_map <- load("bnb_data.Rdata") %>%
dplyr::select(longitude & latitude & X)
View(bnb.data)
bnb_map <- load("bnb_data.Rdata") %>%
dplyr::select(longitude, latitude, X)
?select
bnb_map <- load("bnb_data.Rdata") %>%
dplyr::select(longitude, latitude, X)
bnb_map <- bnb.data %>%
dplyr::select(longitude, latitude, X)
View(bnb_map)
library(ggplot2)
library(maps)
states_map <- map_data("state")
# head(states_map)
View(states_map)
bnb_map <- bnb.data %>%
dplyr::select(longitude, latitude, X) %>%
rename(long = longitude, lat = latitude)
map.data <- states_map %>%
left_join(bnb_map, by = c(long, lat))
View(bnb.data)
View(bnb_map)
?left_join
map.data <- states_map %>%
left_join(bnb_map, by = c("long", "lat"))
View(map.data)
View(bnb_map)
View(bnb.data)
?str_pad
bnb.data <- bnb.raw %>%
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(zipcode = as.character(zipcode)) %>%
mutate(zipcode = str_pad(zipcode,5,side="left",pad="0"))
bnb.raw <- read.csv("airbnb_data.csv") %>%
mutate(price = exp(log_price))
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(zoo)
library(lubridate)
library(ggplot2)
library(stringr)
bnb.raw <- read.csv("airbnb_data.csv") %>%
mutate(price = exp(log_price))
bnb.data <- bnb.raw %>%
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(zipcode = as.character(zipcode)) %>%
mutate(zipcode = str_pad(zipcode,5,side="left",pad="0")) %>%
mutate(amenities = as.character(amenities)) %>%
mutate(am_Internet = (str_detect(amenities, "Internet") |
str_detect(amenities, "Wireless Internet")),
am_TV = (str_detect(amenities, "TV") | str_detect(amenities, "Cable TV")),
am_AC = str_detect(amenities, "Air conditioning"),
am_Kitchen = str_detect(amenities, "Kitchen"),
am_Heating = str_detect(amenities, "Heating"),
am_Washer = str_detect(amenities, "Washer"),
am_Dryer = str_detect(amenities, "Dryer"),
am_Parking = str_detect(amenities, "Free parking on premises"),
am_Shampoo = str_detect(amenities, "Shampoo"),
am_Essentials = str_detect(amenities, "Essentials"))
save(bnb.data, file = "bnb_data.Rdata")
View(bnb.data)
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(maps)
us <- map_data("state")
# head(states_map)
load("bnb_data.Rdata")
ggplot(bnb.data,aes(longitude,latitude)) +
geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
ggplot(bnb.data,aes(longitude,latitude)) +
geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price, size = price),alpha=.25) +
xlim(-125,-65)+ylim(20,50)
ggplot(bnb.data,aes(longitude,latitude)) +
geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
summary(bnb.data$city)
LA.data <- bnb.data %>%
filter(city=="LA")
ggplot(LA.data,aes(longitude,latitude)) +
geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
View(us)
ca <- filter(us, group=="california")
ggplot(bnb.data,aes(longitude,latitude)) +
geom_polygon(data=ca,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
ggplot(bnb.data,aes(longitude,latitude)) +
geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
summary(bnb.data$city)
?map_data
ca <- map_data("California")
?namespace::maps
map_data
map_data$region
?map_data
ca <- map_data("county")
View(ca)
View(ca)
ca <- map_data("county") %>%
filter(region == "california")
ggplot(bnb.data,aes(longitude,latitude)) +
geom_polygon(data=ca,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
bnb.ca <- filter(bnb.data, city == "LA" | city == "SF")
View(bnb.ca)
ggplot(bnb.ca,aes(longitude,latitude)) +
geom_polygon(data=ca,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-65)+ylim(20,50)
summary(ca)
ggplot(bnb.ca,aes(longitude,latitude)) +
geom_polygon(data=ca,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-114)+ylim(32,43)
?map_data
ggplot(bnb.ca,aes(longitude,latitude)) +
geom_polygon(data=ca,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
geom_point(aes(color = price),size=.15,alpha=.25) +
xlim(-125,-114)+ylim(32,43) +
coord_fixed(1.3)
?coord_fixed(1.3)
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(zoo)
library(lubridate)
library(ggplot2)
library(stringr)
# packages for word cloud
# install.packages("tm")  # for text mining
# install.packages("SnowballC") # for text stemming
# install.packages("wordcloud") # word-cloud generator
# install.packages("RColorBrewer") # color palettes
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
# read airbnb.data from csv file
bnb.raw <- read.csv("airbnb_data.csv") %>%
mutate(price = exp(log_price))
# deal with date and zipcode
bnb.data <- bnb.raw %>% # date
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(zipcode = as.character(zipcode)) %>% # zipcode
mutate(zipcode = str_pad(zipcode,5,side="left",pad="0"))
# deal with amenities
bnb.data <- bnb.data %>%
mutate(amenities = as.character(amenities)) %>%
mutate(number_of_amenities = 1 + str_count(amenities, ",")) %>%
mutate(am_Internet = (str_detect(amenities, "Internet") |
str_detect(amenities, "Wireless Internet")),
am_TV = (str_detect(amenities, "TV") | str_detect(amenities, "Cable TV")),
am_AC = str_detect(amenities, "Air conditioning"),
am_Kitchen = str_detect(amenities, "Kitchen"),
am_Heating = str_detect(amenities, "Heating"),
am_Washer = str_detect(amenities, "Washer"),
am_Dryer = str_detect(amenities, "Dryer"),
am_Parking = str_detect(amenities, "Free parking on premises"),
am_Shampoo = str_detect(amenities, "Shampoo"),
am_Smoke = str_detect(amenities, "Smoke Detector"),
am_Hangers = str_detect(amenities, "Hangers"),
am_Iron = str_detect(amenities, "Iron"),
am_Fire = str_detect(amenities, "Fire Extinguisher"),
am_Firstaid = str_detect(amenities, "First Aid Kit"))
# deal with '%'
bnb.data <- bnb.data %>%
mutate(host_response_rate = as.character(host_response_rate),
host_response_rate = str_sub(host_response_rate,1L,-2L), #remove "%"
host_response_rate = as.numeric(host_response_rate)*0.01) # trans to digit
# add has_review for those has review
bnb.data <- bnb.data %>%
mutate(has_review = ifelse(number_of_reviews==0,0,1),
has_review = as.factor(has_review))
save(bnb.data, file = "bnb_data.Rdata")
View(bnb.data)
summary(bnb.data)
# deal with date and zipcode
bnb.data <- bnb.raw %>% # date
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(zipcode = as.character(zipcode)) %>% # zipcode
mutate(zipcode = str_pad(zipcode,5,side="left",pad="0"))
# deal with amenities
bnb.data <- bnb.data %>%
mutate(amenities = as.character(amenities)) %>%
mutate(number_of_amenities = 1 + str_count(amenities, ",")) %>%
mutate(am_Internet = (str_detect(amenities, "Internet") |
str_detect(amenities, "Wireless Internet")),
am_TV = (str_detect(amenities, "TV") | str_detect(amenities, "Cable TV")),
am_AC = str_detect(amenities, "Air conditioning"),
am_Kitchen = str_detect(amenities, "Kitchen"),
am_Heating = str_detect(amenities, "Heating"),
am_Washer = str_detect(amenities, "Washer"),
am_Dryer = str_detect(amenities, "Dryer"),
am_Parking = str_detect(amenities, "Free parking on premises"),
am_Shampoo = str_detect(amenities, "Shampoo"),
am_Smoke = str_detect(amenities, "Smoke detector"),
am_Hangers = str_detect(amenities, "Hangers"),
am_Iron = str_detect(amenities, "Iron"),
am_Fire = str_detect(amenities, "Fire extinguisher"),
am_Firstaid = str_detect(amenities, "First aid kit"))
# deal with '%'
bnb.data <- bnb.data %>%
mutate(host_response_rate = as.character(host_response_rate),
host_response_rate = str_sub(host_response_rate,1L,-2L), #remove "%"
host_response_rate = as.numeric(host_response_rate)*0.01) # trans to digit
# add has_review for those has review
bnb.data <- bnb.data %>%
mutate(has_review = ifelse(number_of_reviews==0,0,1),
has_review = as.factor(has_review))
save(bnb.data, file = "bnb_data.Rdata")
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(zoo)
library(lubridate)
library(ggplot2)
library(stringr)
# packages for word cloud
# install.packages("tm")  # for text mining
# install.packages("SnowballC") # for text stemming
# install.packages("wordcloud") # word-cloud generator
# install.packages("RColorBrewer") # color palettes
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
# read airbnb.data from csv file
bnb.raw <- read.csv("airbnb_data.csv") %>%
mutate(price = exp(log_price))
summary(bnb.data)
# deal with date and zipcode
bnb.data <- bnb.raw %>% # date
mutate(host_since   = as.Date(host_since,   format = "%m/%d/%y"),
first_review = as.Date(first_review, format = "%m/%d/%y"),
last_review  = as.Date(last_review,  format = "%m/%d/%y")) %>%
mutate(post_wait = time_length(host_since %--% first_review, unit = "day")) %>%
mutate(zipcode = as.character(zipcode)) %>% # zipcode
mutate(zipcode = str_pad(zipcode,5,side="left",pad="0"))
# deal with amenities
bnb.data <- bnb.data %>%
mutate(amenities = as.character(amenities)) %>%
mutate(number_of_amenities = 1 + str_count(amenities, ",")) %>%
mutate(am_Internet = (str_detect(amenities, "Internet") |
str_detect(amenities, "Wireless Internet")),
am_TV = (str_detect(amenities, "TV") | str_detect(amenities, "Cable TV")),
am_AC = str_detect(amenities, "Air conditioning"),
am_Kitchen = str_detect(amenities, "Kitchen"),
am_Heating = str_detect(amenities, "Heating"),
am_Washer = str_detect(amenities, "Washer"),
am_Dryer = str_detect(amenities, "Dryer"),
am_Parking = str_detect(amenities, "Free parking on premises"),
am_Shampoo = str_detect(amenities, "Shampoo"),
am_Smoke = str_detect(amenities, "Smoke detector"),
am_Hangers = str_detect(amenities, "Hangers"),
am_Iron = str_detect(amenities, "Iron"),
am_Fire = str_detect(amenities, "Fire extinguisher"),
am_Firstaid = str_detect(amenities, "First aid kit"))
# deal with '%'
bnb.data <- bnb.data %>%
mutate(host_response_rate = as.character(host_response_rate),
host_response_rate = str_sub(host_response_rate,1L,-2L), #remove "%"
host_response_rate = as.numeric(host_response_rate)*0.01) # trans to digit
# add has_review for those has review
bnb.data <- bnb.data %>%
mutate(has_review = ifelse(number_of_reviews==0,0,1),
has_review = as.factor(has_review))
save(bnb.data, file = "bnb_data.Rdata")
summary(bnb.data)
# http://www.sthda.com/english/wiki/text-mining-and-word-cloud-fundamentals-in-r-5-simple-steps-you-should-know
# find Top10 listed amenities
ame <- str_c(bnb.data$amenities, sep = "", collapse = "") %>%
str_to_title() %>%
str_replace_all(" ", "") %>%
str_replace_all("\\{", "") %>%
str_replace_all("\\}", "") %>%
str_replace_all(",", " ")
# Load the data as a corpus
docs <- Corpus(VectorSource(ame))
# text transformation
toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
docs <- tm_map(docs, toSpace, "\"")
# Build a term-document matrix
dtm <- TermDocumentMatrix(docs)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
head(d, 10)
# Word cloud
set.seed(1234)
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
max.words=200, random.order=FALSE, rot.per=0.35,
colors=brewer.pal(8, "Dark2"))
write.table(d, file = "top_listed_amenity.txt", sep = ",", quote = FALSE, row.names = F)
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
# upload data
load("bnb_data.Rdata")
# upload packages
library(dplyr)
library(ggplot2)
plot(bnb.data$number_of_amenities,bnb.data$review_scores_rating)
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price),alpha=I(1/5))  +
scale_y_continuous(limits = c(2,8)) +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price),alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price),color = ranbow(1), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price),color = rainbow(1), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price),color = rainbow(2), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price),colour = rainbow(2), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price, size = log_price), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = number_of_amenities, y = review_scores_rating)) +
geom_point(aes(color = log_price), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = post_wait, y = review_scores_rating)) +
geom_point(aes(color = log_price), alpha=I(1/5))  +
scale_y_continuous() +
theme_minimal()
ggplot(bnb.data, aes(x = post_wait, y = review_scores_rating)) +
geom_point(aes(color = log_price), alpha=I(1/5))  +
scale_x_continuous(limits = c(0,max(bnb.data$post_wait))) +
theme_minimal()
# https://daviddalpiaz.github.io/r4sl/knn-reg.html#knn-in-r
rm(list= ls())
knitr::opts_chunk$set(echo = TRUE)
# install.packages("FNN")
library(FNN)
library(MASS)
library(dplyr)
load("bnb_city.Rdata")
# RMSE
rmse = function(actual, predicted) {
sqrt(mean((actual - predicted) ^ 2))
}
# define helper function for getting knn.reg predictions
make_knn_pred = function(k = 1, training, predicting, y = y_trn) {
pred = FNN::knn.reg(train = scale(training),
test  = scale(predicting),
y = y,
k = k)$pred
act  = y[,1]
rmse(predicted = pred, actual = act)
}
# define values of k to evaluate
k = c(1, 5, 10, 25, 50, 250, 500, 840,1000,3000)
# Drop NA's. (refer to all the predictors (Group3) we need)
whole <- dplyr::select(bnb.data, X, log_price, latitude, longitude,
accommodates, beds, bedrooms, bathrooms, number_of_amenities,
review_scores_rating, number_of_reviews, host_response_rate) %>%
na.omit()
train.data <- filter(train.data, X %in% whole$X)
test.data <- filter(test.data, X %in% whole$X)
# responser
y_trn <- dplyr::select(train.data, log_price)
y_tst <- dplyr::select(test.data, log_price)
# Fisrt Group ----
X1_trn <- dplyr::select(train.data, latitude, longitude)
X1_tst <- dplyr::select(test.data, latitude, longitude)
# get requested train RMSEs
knn_trn_rmse1 = sapply(k, make_knn_pred,
training = X1_trn,
predicting = X1_trn)
